<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<th:block th:replace="~{fragment/layout::layout('로그인페이지',~{this::content},~{this::script})}">

	<div th:fragment="content">
		<h1>장바구니</h1>
		<div id="cartList"></div>
	</div>

	<th:block th:fragment="script">
		<script th:inline="javascript">
			function clist(){
                $.ajax({
	                url:"/cart/list",
	                method:"GET",
                    headers: {
                        "X-Requested-With": "XMLHttpRequest"
                    },
	                success:function (items){
                        $("#cartList").empty();

                        if (items.length === 0) {
                            $("#cartList").append("<p>장바구니가 비어있습니다.</p>");
                            return;
                        }

						items.forEach(t => {
                            const html = `
                                <div id="cart${t.cmid}" class="cart-item">
                                <input type="checkbox" class="cart-check" value="${t.cmid}">
                                <img src="/images/${t.img}" alt="${t.name}" width="100">
                                <p>상품명: ${t.name}</p>
                                <p>가격: ${t.price}원</p>
                            <p>
                                수량:
                                <input type="number" id="quantity-${t.cmid}" value="${t.quantity}" min="1" style="width: 60px;">
                                    <button onclick="updateQuantity(${t.cmid})">수량변경</button>
                            </p>
                            <p>총 가격: ${t.totalprice}원</p>
                            </div>
                            <hr>`;

                            $("#cartList").append(html);
						})
	                },
                    error: function(xhr) {
                        if (xhr.status === 401) {
                            alert("로그인이 필요합니다.");
                            location.href = "/member/login";
                        } else {
                            console.log("오류:", xhr.responseText);
                        }
                    }
                });

			}
            clist();


		</script>
	</th:block>


</th:block>
</html>